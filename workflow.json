{
  "name": "ì•±ìŠ¤í† ì–´ ë¦¬ë·° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 60
            }
          ]
        },
        "triggerTimes": {
          "item": [
            {
              "mode": "interval",
              "hour": 9,
              "minute": 0
            }
          ]
        },
        "timezone": "Asia/Seoul"
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -128,
        112
      ],
      "id": "schedule-trigger-daily",
      "name": "Schedule Trigger (Hourly Strategy)",
      "notes": "RSS 50ê°œ ì œí•œ ëŒ€ì‘ì„ ìœ„í•´ 1ì‹œê°„ ì£¼ê¸°ë¡œ ë³€ê²½í•¨"
    },
    {
      "parameters": {
        "url": "https://itunes.apple.com/kr/rss/customerreviews/limit=50/id=1018769995/sortBy=mostRecent/json",
        "options": {
          "response": {
            "response": {
              "responseFormat": "json"
            }
          },
          "timeout": 30000,
          "retryOnFail": true,
          "maxTries": 3
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        64,
        -16
      ],
      "id": "638e245b-1e11-4e26-92d5-36de6e727396",
      "name": "HTTP Request",
      "notes": "ì•±ìŠ¤í† ì–´ ë¦¬ë·° API í˜¸ì¶œ\n\nURL í˜•ì‹: https://itunes.apple.com/{êµ­ê°€ì½”ë“œ}/rss/customerreviews/limit={ê°œìˆ˜}/id={ì•±ID}/sortBy=mostRecent/json\n\në‹¤ë¥¸ ì•±ìœ¼ë¡œ ë³€ê²½: URLì—ì„œ ì•± IDì™€ êµ­ê°€ì½”ë“œ ìˆ˜ì •\nlimit: ìµœëŒ€ 50ê°œ (íŒŒë¼ë¯¸í„° ì§€ì •í•´ë„ ìµœëŒ€ 50ê°œ ë°˜í™˜ ê°€ëŠ¥)"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=# Input Data (JSON List)\n{{ JSON.stringify($('HTTP Request').item.json.feed.entry) }}\n\n# Task\nìœ„ JSON ë°ì´í„°(ë¦¬ë·° ë¦¬ìŠ¤íŠ¸)ë¥¼ í•˜ë‚˜ì”© ë¶„ì„í•´ì„œ, ì•„ë˜ ì •ë³´ë¥¼ í¬í•¨í•œ **ìƒˆë¡œìš´ JSON List**ë¥¼ ë§Œë“¤ì–´.\n(ìˆœì„œë¥¼ ì ˆëŒ€ ë°”ê¾¸ì§€ ë§ê³  ì…ë ¥ëœ ê°œìˆ˜ ê·¸ëŒ€ë¡œ ì¶œë ¥í•´.)\n\n# Output Format (Array of Objects)\n[\n  {\n    \"author\": \"ì›ë¬¸ ì‘ì„±ì ì´ë¦„ ê·¸ëŒ€ë¡œ\",\n    \"date\": \"ì›ë¬¸ updated ë‚ ì§œ ê·¸ëŒ€ë¡œ\",\n    \"rating\": \"ì›ë¬¸ ë³„ì (im:rating) ê·¸ëŒ€ë¡œ\",\n    \"content\": \"ì›ë¬¸ ë‚´ìš©(content) ê·¸ëŒ€ë¡œ\",\n    \"priority\": \"ğŸš¨ Critical / âš ï¸ High / âœ… Normal ì¤‘ íƒ1\",\n    \"category\": \"ë²„ê·¸ / ì‚¬ìš©ì„± / ì¹­ì°¬ / ê¸°íƒ€ ì¤‘ íƒ1\",\n    \"summary\": \"ë‚´ìš© 1ì¤„ ìš”ì•½\"\n  },\n  ... (ë°˜ë³µ)\n]\n\n(ì˜¤ì§ JSON ë°ì´í„°ë§Œ ì¶œë ¥í•´. ë§ˆí¬ë‹¤ìš´ ì½”ë“œë¸”ë¡ ì“°ì§€ ë§ˆ.)\n\nIMPORTANT: Return ONLY the JSON array. Do not include markdown formatting like ```json. If content is empty, set summary to 'ë‚´ìš© ì—†ìŒ'.",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.8,
      "position": [
        464,
        256
      ],
      "id": "0ed4ad28-e5bc-46db-aa46-25b1b2cef11b",
      "name": "Basic LLM Chain",
      "retryOnFail": false,
      "waitBetweenTries": 2000,
      "maxTries": 1,
      "executeOnce": true,
      "notes": "AI ë¦¬ë·° ë¶„ì„ (Google Gemini)\n\nì¶”ì¶œ ì •ë³´: ê¸´ê¸‰ë„(Critical/High/Normal), ìœ í˜•(ë²„ê·¸/ì‚¬ìš©ì„±/ì¹­ì°¬/ê¸°íƒ€), ìš”ì•½\n\nGemini API ë¬´ë£Œ í‹°ì–´: RPD 20íšŒ/ì¼, RPM 5íšŒ/ë¶„\ní˜„ì¬ ì„¤ì •: ë§¤ì¼ 1íšŒ ì‹¤í–‰ìœ¼ë¡œ í•œë„ ì¤€ìˆ˜"
    },
    {
      "parameters": {
        "jsCode": "const aiResponse = $input.item.json.text || $input.item.json.output || '';\n\nlet originalEntries = [];\ntry {\n  const httpRequestData = $('HTTP Request').item.json;\n  if (httpRequestData?.feed?.entry) {\n    originalEntries = httpRequestData.feed.entry;\n  }\n} catch (error) {\n  console.error('ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);\n}\n\nlet jsonString = aiResponse.trim().replace(/```json\\s*/g, '').replace(/```\\s*/g, '').trim();\n\nlet parsedData = [];\ntry {\n  parsedData = JSON.parse(jsonString);\n  if (!Array.isArray(parsedData)) {\n    parsedData = [parsedData];\n  }\n} catch (error) {\n  console.error('JSON íŒŒì‹± ì‹¤íŒ¨:', error);\n  parsedData = [];\n}\n\nconst items = parsedData.map((item, index) => {\n  const originalEntry = originalEntries[index] || {};\n\n  const originalAuthor = originalEntry.author?.name?.label || originalEntry.author?.name || item.author || '';\n  const originalDate = originalEntry.updated?.label || originalEntry.updated || item.date || '';\n  const originalRating = originalEntry['im:rating']?.label || originalEntry['im:rating'] || item.rating || '';\n  const originalContent = originalEntry.content?.label || originalEntry.content || originalEntry.content?.['#text'] || item.content || '';\n  const originalId = originalEntry.id?.label || originalEntry.id || '';\n\n  return {\n    json: {\n      priority: item.priority || '',\n      category: item.category || '',\n      summary: item.summary || '',\n      author: originalAuthor,\n      date: originalDate,\n      rating: originalRating,\n      content: originalContent,\n      id: originalId,\n      _originalEntry: originalEntry,\n      _index: index\n    }\n  };\n});\n\nif (items.length > 0) {\n  return items;\n}\n\nreturn [{\n  json: {\n    ID: `PARSE_ERROR_${Date.now()}`,\n    ê¸´ê¸‰ë„: 'ERROR',\n    ìœ í˜•: 'íŒŒì‹±ì‹¤íŒ¨',\n    ìš”ì•½: 'No valid data parsed',\n    ì›ë³¸: aiResponse.toString().slice(0, 1500),\n    ë³„ì : '',\n    ì‘ì„±ì: 'system',\n    ì‘ì„±ì¼ì‹œ: new Date().toISOString()\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        664,
        256
      ],
      "id": "parse-json-response",
      "name": "Parse JSON Response"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        464,
        112
      ],
      "id": "848e3076-2ed7-44d1-a766-76479b6aaed9",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "hFK58SlSvL4vLAvu",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "=",
          "mode": "id",
          "cachedResultName": "VOC_DB",
          "cachedResultUrl": ""
        },
        "sheetName": {
          "__rl": true,
          "value": "=Sheet1",
          "mode": "list",
          "cachedResultName": "1",
          "cachedResultUrl": ""
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        864,
        112
      ],
      "id": "get-existing-reviews",
      "name": "Get Existing Reviews",
      "executeOnce": true,
      "alwaysOutputData": true,
      "notes": "ê¸°ì¡´ ë¦¬ë·° ë°ì´í„° ì½ê¸°\n\nGoogle Sheetsì—ì„œ ê¸°ì¡´ ë¦¬ë·°ë¥¼ ì½ì–´ ì¤‘ë³µ ì²´í¬ì— ì‚¬ìš©\nì„¤ì •: Document í•„ë“œì— Google Sheets ID, Sheet í•„ë“œì— ì‹œíŠ¸ ì´ë¦„ ì…ë ¥",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbOdmn4YKzkqCylB",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const existingIds = new Set();\n\ntry {\n  const existingReviewsNode = $('Get Existing Reviews');\n  if (existingReviewsNode) {\n    const existingReviews = existingReviewsNode.all();\n    if (Array.isArray(existingReviews) && existingReviews.length > 0) {\n      existingReviews.forEach(item => {\n        const id = (item.json?.ID || item.json?.id || '').toString().trim();\n        if (id) {\n          existingIds.add(id);\n        }\n      });\n    }\n  }\n} catch (error) {\n  console.log('ê¸°ì¡´ ë¦¬ë·° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', error.message || error);\n}\n\nconst currentItems = $input.all();\nif (!currentItems || currentItems.length === 0) {\n  return [];\n}\n\nconst newItems = currentItems.filter(item => {\n  const id = (item.json?.id || '').toString().trim();\n  return id.length > 0 && !existingIds.has(id);\n});\n\nreturn newItems.map(item => {\n  const row = item.json || {};\n  return {\n    json: {\n      ID: row.id || '',\n      ê¸´ê¸‰ë„: row.priority || '',\n      ìœ í˜•: row.category || '',\n      ìš”ì•½: row.summary || '',\n      ì›ë³¸: row.content || '',\n      ë³„ì : row.rating || '',\n      ì‘ì„±ì: row.author || '',\n      ì‘ì„±ì¼ì‹œ: row.date || ''\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1088,
        256
      ],
      "id": "check-duplicate-filter",
      "name": "Filter Duplicates"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "=",
          "mode": "id",
          "cachedResultName": "VOC_DB",
          "cachedResultUrl": ""
        },
        "sheetName": {
          "__rl": true,
          "value": "=Sheet1",
          "mode": "name",
          "cachedResultName": "1",
          "cachedResultUrl": ""
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "useAppend": true,
          "cellFormat": "USER_ENTERED",
          "handlingExtraData": "insertInNewColumn"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1312,
        256
      ],
      "id": "0489b3d5-2b66-4697-aa8c-8800f55c8857",
      "name": "Append row in sheet",
      "notes": "ì‹œíŠ¸ì— ë¦¬ë·° ì¶”ê°€\n\nì¤‘ë³µì´ ì•„ë‹Œ ìƒˆ ë¦¬ë·°ë¥¼ Google Sheetsì— ì¶”ê°€\nì»¬ëŸ¼: ì‘ì„±ì¼ì‹œ, ì‘ì„±ì, ë³„ì , ê¸´ê¸‰ë„, ìœ í˜•, ìš”ì•½, ì›ë³¸",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbOdmn4YKzkqCylB",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-critical-rating",
              "leftValue": "={{ (() => { const p = (($json.priority || $json.ê¸´ê¸‰ë„ || '').toString().replace(/[ğŸš¨âš ï¸âœ…]/g, '').trim().toLowerCase()); const r = Number(($json.rating || $json.ë³„ì  || '0').toString().trim()); return (p.includes('critical') && r <= 2) ? 'yes' : 'no'; })() }}",
              "rightValue": "yes",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        1520,
        256
      ],
      "id": "check-critical-priority",
      "name": "Check Critical Priority"
    },
    {
      "parameters": {
        "jsCode": "const inputItems = $input.all();\nif (!inputItems || inputItems.length === 0) {\n  return [];\n}\n\nlet originalEntries = [];\ntry {\n  const httpRequestData = $('HTTP Request').item.json;\n  if (httpRequestData?.feed?.entry) {\n    originalEntries = httpRequestData.feed.entry;\n  }\n} catch (error) {\n  console.error('ì›ë³¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);\n}\n\nconst results = inputItems.map((inputItemWrapper) => {\n  const inputItem = inputItemWrapper.json || {};\n  const index = inputItem._index !== undefined ? inputItem._index : 0;\n  const originalEntry = originalEntries[index] || {};\n  \n  return {\n    json: {\n      author: inputItem.author || inputItem.ì‘ì„±ì || originalEntry?.author?.name?.label || originalEntry?.author?.name || 'ì•Œ ìˆ˜ ì—†ìŒ',\n      rating: inputItem.rating || inputItem.ë³„ì  || originalEntry?.['im:rating']?.label || originalEntry?.['im:rating'] || 'N/A',\n      date: inputItem.date || inputItem.ì‘ì„±ì¼ì‹œ || originalEntry?.updated?.label || originalEntry?.updated || 'N/A',\n      content: inputItem.content || inputItem.ì›ë³¸ || originalEntry?.content?.label || originalEntry?.content || originalEntry?.content?.['#text'] || 'N/A',\n      priority: inputItem.priority || inputItem.ê¸´ê¸‰ë„ || 'N/A',\n      category: inputItem.category || inputItem.ìœ í˜• || 'N/A',\n      summary: inputItem.summary || inputItem.ìš”ì•½ || 'N/A'\n    }\n  };\n});\n\nreturn results.length > 0 ? results : [];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1728,
        144
      ],
      "id": "prepare-telegram-data",
      "name": "Prepare Telegram Data"
    },
    {
      "parameters": {
        "chatId": "=",
        "text": "=ğŸš¨ **ê¸´ê¸‰ ë¦¬ë·° ì•Œë¦¼**\n\n**ì‘ì„±ì:** {{ $json.author || 'ì•Œ ìˆ˜ ì—†ìŒ' }}\n**ë³„ì :** {{ $json.rating || 'N/A' }}\n**ê¸´ê¸‰ë„:** {{ $json.priority || 'N/A' }}\n**ìœ í˜•:** {{ $json.category || 'N/A' }}\n**ìš”ì•½:** {{ $json.summary || 'N/A' }}\n\n**ì›ë³¸ ë¦¬ë·°:**\n{{ $json.content || 'N/A' }}\n\n**ì‘ì„±ì¼ì‹œ:** {{ $json.date || 'N/A' }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1936,
        144
      ],
      "id": "telegram-notification",
      "name": "Send Telegram Alert",
      "notes": "í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì „ì†¡\n\nCritical ë¦¬ë·° ë°œê²¬ ì‹œ í…”ë ˆê·¸ë¨ìœ¼ë¡œ ì•Œë¦¼ ì „ì†¡\nì„¤ì •: Chat ID í•„ë“œì— í…”ë ˆê·¸ë¨ Chat ID ì…ë ¥, Credentialsì— ë´‡ í† í° ì—°ê²°"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": false,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-parse-error",
              "leftValue": "={{ (($json.ID || '').toString().startsWith('PARSE_ERROR_')) ? \"yes\" : \"no\" }}",
              "rightValue": "yes",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        864,
        256
      ],
      "id": "cdcd9089-0930-40f0-8be9-7876aa998a88",
      "name": "Has Parse Error?"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "=",
          "mode": "id",
          "cachedResultName": "VOC_DB",
          "cachedResultUrl": ""
        },
        "sheetName": {
          "__rl": true,
          "value": "=Sheet1",
          "mode": "name",
          "cachedResultName": "1",
          "cachedResultUrl": ""
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {
          "useAppend": true,
          "cellFormat": "USER_ENTERED",
          "handlingExtraData": "insertInNewColumn"
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1088,
        64
      ],
      "id": "200b3761-1dd2-4585-9181-e94459fc881c",
      "name": "Append parse error row",
      "notes": "LLM/íŒŒì‹± ì˜¤ë¥˜ ë¡œê·¸ë¥¼ ì‹œíŠ¸ì— ì €ì¥",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "pbOdmn4YKzkqCylB",
          "name": "Google Sheets account 2"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Schedule Trigger (Hourly Strategy)": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Get Existing Reviews",
            "type": "main",
            "index": 0
          },
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "Parse JSON Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse JSON Response": {
      "main": [
        [
          {
            "node": "Has Parse Error?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Parse Error?": {
      "main": [
        [
          {
            "node": "Append parse error row",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Filter Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Duplicates": {
      "main": [
        [
          {
            "node": "Append row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append row in sheet": {
      "main": [
        [
          {
            "node": "Check Critical Priority",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Critical Priority": {
      "main": [
        [
          {
            "node": "Prepare Telegram Data",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Prepare Telegram Data": {
      "main": [
        [
          {
            "node": "Send Telegram Alert",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "564907cd-e480-4dd7-b4a9-ac110f8753d8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "c27d064a6e15cfa5f1c76c2310a89e8ca09bd449035a086d7f89cbec45e88dc6"
  },
  "id": "lNqHbXsn5v1DUqfq",
  "tags": []
}
